@model DeanOBrien.Feature.LanguageAssistant.Models.LanguageAssistantViewModel
<html>
<head>
    <script src="/sitecore/shell/client/Applications/LanguageAssistant/js/jquery-1.12.4.min.js" charset="utf-8" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <link rel="shortcut icon" href="/sitecore/images/favicon.ico" />
    <link href="/sitecore/shell/client/Applications/LaunchPad/LaunchPad.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link href="/sitecore/shell/client/Applications/ExperienceAnalytics/Common/ExperienceAnalytics.css" rel="stylesheet" type="text/css" />
    <link href="/sitecore/shell/client/Applications/LanguageAssistant/css/LanguageAssistant.css" rel="stylesheet" type="text/css" />
</head>
<body class="sc">
    <div id="overlay" style="width:100%;height:100%;display:none"><div class="spinner"><img src="https://corp-devint.northumbria.ac.uk/common/images/lg.gif"></div></div>
    <header class="sc-globalHeader">
        <div class="row sc-globalHeader-content">
            <div class="col-md-3">
                <div class="sc-globalHeader-startButton">
                    <a class="sc-global-logo medium" href="/sitecore/shell/sitecore/client/applications/launchpad"></a>
                </div>
                <div class="sc-globalHeader-navigationToggler">

                </div>
                <div class="sc-globalheader-appName">

                </div>
            </div>
            <div class="col-md-6 report-header" style="background-color:gold;color:#000;">
                <span id="report-title"><b>Language Assistant</b></span>
                <form class="navbar-form navbar-left" role="search" style="display: inline-block; float: right !important; margin: 0px">
                    <div class="form-group">
                        <input type="text" id="promptDetails" name="promptDetails" class="form-control" placeholder="or write your own prompt" style="min-width:200px">
                        <input type="hidden" id="id" name="id" value="@(Model.ItemId)">
                        <input type="hidden" id="prompt" name="prompt" value="-2">
                    </div>
                    <button type="submit" class="btn btn-primary">Submit</button>
                </form>
                <div class="dropdown" style="display:inline-block;float:right !important;margin-top:8px">
                    <button class="btn dropdown-toggle" type="button" id="dropdown-menu-button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        Prompts
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdown-menu-button" id="main-menu">
                        @foreach (var item in Model.Prompts)
                        {
                            <a class="dropdown-item" href="?id=@(Model.ItemId)&prompt=@(item.Item1)" style="display:block">@(item.Item2)</a>
                        }
                    </div>

                </div>



            </div>
            <div class="col-md-3">
                <div class="sc-globalHeader-loginInfo">
                    <ul data-sc-id="c_c642516f92b266a2" class="sc-accountInformation sc_AccountInformation_3 data-sc-registered" data-sc-require="/-/speak/v1/business/AccountInformation.js">
                        <li>
                            <a class="btn btn-primary" id="advanced-search-button" data-toggle="collapse" href="#advanced-search" role="button" aria-expanded="false" aria-controls="advanced-search">Advanced Search</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </header>
    <section class="sc-applicationContent">
        <header class="sc-applicationHeader">

            <div class="sc-applicationHeader-row1 no-breadcrumb">
                <div class="sc-applicationHeader-content">
                    <div class="sc-applicationHeader-title">
                        <span data-sc-id="Text2" class="sc-text sc_Text_8 data-sc-registered" data-bind="text: text, visible: isVisible" data-sc-require="/-/speak/v1/business/text.js">Sitecore Experience Platform</span>
                    </div>
                </div>
            </div>

        </header>
    </section>

    <div class="row collapse bg-info" id="advanced-search">
        <h3>Advanced Search</h3>
        <form class="px-4 py-3">
            <div class="col-md-6">


                <input type="hidden" id="id" name="id" value="@(Model.ItemId)">
                <input type="hidden" id="prompt" name="prompt" value="-2">
                <input type="hidden" id="field" name="field" value="@Model.Field">
                <div class="form-group row">
                    <div class="col-md-6">
                        <label for="fieldId">Field</label>
                    </div>
                    <div class="col-md-6">
                        <select id="fieldId" class="form-control">
                            <option value="0" data-field="custom">Custom</option>
                            @{
                                int count = 0;

                                foreach (var item in Model.Fields)
                                {
                                    count++;
                                    var fieldOptionDisplay = item.Item1 == Model.Field ? "selected" : "";

                                    <option value='@count' data-field='@item.Item1' @fieldOptionDisplay>@item.Item1</option>
                                }
                            }
                        </select>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-md-6">
                        <label for="deployedModel">Deployed Model</label>
                    </div>
                    <div class="col-md-6">
                        <select id="deployedModel" name="deployedModel" class="form-control">

                            @foreach (var item in Model.DeployedModels)
                            {
                                var deployedModelDisplay = item == Model.DeployedModel ? "selected" : "";

                                <option @deployedModelDisplay>@item</option>
                            }

                        </select>
                    </div>
                </div>
                <div class="form-group row">
                    <div class="col-md-6">
                        <label for="promptDetails">Prompt</label>
                    </div>
                    <div class="col-md-6">
                        <textarea class="form-control" id="promptDetails" name="promptDetails" placeholder="Enter custom prompt here..." style="min-height:203px">@Model.MainPrompt</textarea>
                    </div>
                </div>


            </div>
            <div class="col-md-6">
                <div class="form-group row">
                    <div class="col-md-3">
                        <label for="Context">Context</label>
                    </div>
                    <div class="col-md-9">
                        @{
                            count = 0;
                            foreach (var item in Model.Fields)
                            {
                                count++;
                                var fieldDisplay = item.Item1 == Model.Field ? "block" : "none";

                                <div id="field-@count" style="display:@(fieldDisplay);border:1px solid #f00;height:auto;" class="fields form-control">@Html.Raw(item.Item2)</div>
                            }
                            <div id="field-0" style="display:@(Model.Field=="custom" ? "block" : "none");border:1px solid #fcc;padding:0" class="fields form-control"><textarea id="customContext" name="customContext" style="min-height:300px;height:100%;width:100%" placeholder="Enter text here or leave empty for no context...">@(Model.Field=="custom" ? Model.OriginalFieldValue : "")</textarea></div>
                        }
                        <button type="submit" class="btn btn-primary" style="margin-top:30px">Submit</button>
                    </div>
                </div>

            </div>
        </form>
    </div>


    @if (string.IsNullOrEmpty(Model.MainPrompt))
    {
        <div class="row alert intro">
            <h2>Language Assistant</h2>
            <div class="col-md-6">
                <h3>Basic</h3>
                <p>With this tool you can ask an AI Assistant to review the main <strong>@Model.Field</strong> field using some common prompts below.</p>
                <ul>
                    @foreach (var item in Model.Prompts)
                    {
                        <li><a class="dropdown-item" href="?id=@(Model.ItemId)&prompt=@(item.Item1)" style="display:block">@(item.Item2)</a></li>
                    }
                </ul>
                <p>Or write your own prompt using the search bar at the top of the window.</p>
                <p>A list of suggestions will be provided on the left of the screen (hover and click on them for more detail).</p>
            </div>
            <div class="col-md-6">
                <h3>Advanced</h3>
                <p>Alternatively, you can use the advanced search tool to specify a different field or enter your own custom text to evaluate.</p>
                <p>Further to this, you can write your own custom prompts to send to the AI Assistant and specify the exact AI model you wish to target.</p>
                <p>The response here is direct from the model and will not include suggestions (unless you ask for them).</p>
                <p><a class="btn btn-primary" id="advanced-search-button" data-toggle="collapse" href="#advanced-search" role="button" aria-expanded="false" aria-controls="advanced-search">Advanced Search</a></p>

            </div>
        </div>
    }
    else
    {
        var contextString = "using the field <strong>" + Model.Field + "</strong> for context";
        if (Model.Field == "custom" && string.IsNullOrEmpty(Model.OriginalFieldValue))
        {
            contextString = string.Empty;
        }

        <div class="row">
            <div class="col-md-12">
                <div class="alert alert-success">
                    <a class="btn btn-primary" data-toggle="collapse" href="#advanced-search" role="button" aria-expanded="false" aria-controls="advanced-search" style="float:right">Edit search</a>
                    Showing result: <strong>@Model.MainPrompt</strong> @Html.Raw(contextString) against <strong>@Model.DeployedModel</strong> model.<br />@Model.TimeTaken
                </div>
            </div>
        </div>


        if (!string.IsNullOrEmpty(Model.FullResponse))
        {
            <div class="row alert direct-response">
                <div class="col-md-12">
                    <h3>Response:</h3>
                    <p>@Html.Raw(Model.FullResponse)</p>
                </div>
            </div>
        }
        else
        {
            <div class="row">
                <div class="col-md-4" style="position:sticky;top:25">
                    <div id="suggestions">
                        <p><b>Suggestions</b></p>
                        <div>
                            @if (Model.Suggestions != null)
                            {
                                int actionsCount = 0;
                                foreach (var suggestion in Model.Suggestions)
                                {

                                    <div class='row'>
                                        <div class='col-md-12'>
                                            <div class="feeddate thumbnail btn-block">@suggestion.Title</div>
                                        </div>
                                    </div>

                                    if (suggestion != null && suggestion.Actions != null)
                                    {
                                        foreach (var action in suggestion.Actions)
                                        {
                                            actionsCount++;

                                            <div class="row" onmouseover="highlightText('@action.Id');" onmouseout="removeHighlightText('@action.Id');">
                                                <div class='col-md-12'>
                                                    <div class='thumbnail'>
                                                        <div class='row'>
                                                            <div class='col-md-12'>
                                                                <div><p><b><a class="" data-toggle="collapse" href="#collapseExample@(actionsCount)" role="button" aria-expanded="false" aria-controls="collapseExample@(actionsCount)">@action.Explanation</a></b></p></div>
                                                            </div>
                                                        </div>
                                                        <div class="collapse" id="collapseExample@(actionsCount)">
                                                            <div class='row'>
                                                                <div class='col-md-12'>
                                                                    <div><p><u>Old</u></p>@Html.Raw(action.OldText)</div>
                                                                </div>
                                                            </div>
                                                            <div class='row'>
                                                                <div class='col-md-12'>
                                                                    <div><p><u>New</u></p>@Html.Raw(action.NewText)</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    }
                                }
                            }

                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div id="OldText">
                        <p><b>Original</b></p>
                        @Html.Raw(Model.OriginalText)
                    </div>
                </div>
                <div class="col-md-4">
                    <div id="Newtext">
                        <p><b>Revised</b></p>
                        @Html.Raw(Model.RevisedText)
                    </div>
                </div>
            </div>
        }
    }
    <script src="/sitecore/shell/client/Applications/LanguageAssistant/js/LanguageAssistant.js" charset="utf-8" type="text/javascript"></script>
</body>
</html>
